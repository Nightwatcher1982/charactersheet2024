/**
 * 子职业特性详情（按等级）：用于升级页、角色卡特性页展示「子职特性」的具体名称与描述
 * 来源：docs/DND资料/ 各职业子职章节
 */

export interface SubclassFeatureDetail {
  name: string;
  nameEn: string;
  description: string;
  details?: string[];
}

/** classId -> subclassId -> level -> 详情（同一等级多条时为数组） */
const SUBCLASS_FEATURES: Record<string, Record<string, Record<number, SubclassFeatureDetail | SubclassFeatureDetail[]>>> = {
  barbarian: {
    berserker: {
      3: {
        name: '狂怒',
        nameEn: 'Frenzy',
        description: '狂暴激活期间，在你使用鲁莽攻击的回合中，你基于力量的攻击首次命中时，对目标造成额外伤害。',
        details: [
          '投掷等于你狂暴伤害加值数量的d6，将它们相加，即是你造成的额外伤害。额外伤害类型与此次攻击所使用的武器或徒手打击造成的伤害类型相同。',
        ],
      },
      6: {
        name: '无我狂暴',
        nameEn: 'Mindless Rage',
        description: '狂暴激活期间，你具有魅惑与恐慌状态的免疫。',
        details: ['当你进入狂暴时，若你已陷入魅惑或恐慌，你陷入的这些状态立即结束。'],
      },
      10: {
        name: '报偿',
        nameEn: 'Retaliation',
        description: '当一名位于你5尺内的生物对你造成伤害时，你能够以反应使用武器或徒手打击对其发动一次近战攻击。',
        details: [],
      },
      14: {
        name: '威慑之姿',
        nameEn: 'Intimidating Presence',
        description: '以一个附赠动作，你可以用你那令人魂消胆丧的面相，在原初之力的辅助下将恐惧打入他者内心。',
        details: [
          '当你如此做时，每个位于以你为源点的30尺光环区域内你所选择的生物必须进行一次感知豁免检定（DC等于8＋你的力量调整值＋你的熟练加值）。豁免失败则陷入恐慌状态，持续1分钟。陷入恐慌的生物在其每个回合结束时重复豁免，成功则终止其身上的该效应。',
          '此特性一经使用，直至完成长休你都无法再次使用。你也可以消耗一次狂暴使用次数（无需动作）来重置此特性的使用权。',
        ],
      },
    },
    beast: {
      3: [
        {
          name: '动物语者',
          nameEn: 'Animal Speaker',
          description: '你可以施展法术野兽知觉与动物交谈，仅限仪式施展。感知是你这些法术的施法属性。',
          details: [],
        },
        {
          name: '兽性狂暴',
          nameEn: 'Rage of the Wilds',
          description: '你的狂暴解放来自动物的原初之力。每当你激活狂暴时，你从下列选项中选择一项。',
          details: [
            '熊：狂暴激活期间，你具有除力场、心灵、暗蚀、光耀外所有伤害类型的抗性。',
            '鹰：当你激活狂暴时，作为你进入狂暴的附赠动作的一部分，你可以同时执行撤离与疾走动作。狂暴激活期间，你也能够以一个附赠动作同时执行这两个动作。',
            '狼：狂暴激活期间，你的盟友对位于你5尺内的敌人进行的攻击检定具有优势。',
          ],
        },
      ],
      6: {
        name: '兽之形貌',
        nameEn: 'Aspect of the Wilds',
        description: '你从下列选项中自选一项能力获得。当你完成一次长休时，你可以改变你的选择。',
        details: ['枭：你具有60尺黑暗视觉。如果你已经具有黑暗视觉，你的黑暗视觉范围增加60尺。', '豹：你具有等于你速度的攀爬速度。', '鲑：你具有等于你速度的游泳速度。'],
      },
      10: {
        name: '自然语者',
        nameEn: 'Nature Speaker',
        description: '你可以施展法术问道自然，仅限仪式施展。感知是你该法术的施法属性。',
        details: [],
      },
      14: {
        name: '兽力威能',
        nameEn: 'Power of the Wilds',
        description: '每当你激活狂暴时，你从下列选项中选择一项。',
        details: [
          '猎鹰：狂暴激活期间，只要你没有着装任何护甲，你就具有等于你速度的飞行速度。',
          '雄狮：狂暴激活期间，任何位于你5尺内的敌人不以你（或另一个选择该项能力的野蛮人）为目标的攻击检定具有劣势。',
          '角羊：狂暴激活期间，当你的近战攻击命中一名体型不超过大型的生物时，你可以令其陷入倒地状态。',
        ],
      },
    },
    'world-tree': {
      3: {
        name: '圣树活力',
        nameEn: 'Vitality of the Tree',
        description: '你的狂暴浸润着世界树的生命力。你获得以下增益：',
        details: [
          '活力之涌：当你激活狂暴时，你获得等于你野蛮人等级的临时生命值。',
          '赐命之源：你的狂暴激活期间，在你的每个回合开始时，你可以赋予位于你10尺内的另一名生物临时生命值。投掷等于你狂暴伤害加值数量的d6，将它们相加，即是该生物获得的临时生命值。当你的狂暴结束时，剩余的临时生命值将会消失。',
        ],
      },
      6: {
        name: '灵树枝杈',
        nameEn: 'Branches of the Tree',
        description: '你的狂暴激活期间，每当你可见的位于你30尺内的生物的回合开始时，你能够以反应在其周围召唤世界树的灵体枝条。',
        details: [
          '目标必须成功通过一次力量豁免（DC等于8+你的力量调整值+你的熟练加值），否则将被传送到位于你5尺内的你可见的未占据空间内或距离你最近的你可见的未占据空间内。目标被你传送后，你可以令其速度降为0，持续至当前回合结束。',
        ],
      },
      10: {
        name: '根击千钧',
        nameEn: 'Battering Roots',
        description: '世界树的卷须将你的武器延长。你的回合内，你持用的任何具有重型或多用词条的近战武器的触及增加10尺。',
        details: ['当你在你的回合内以该武器命中时，除了激活这把武器本身具有的其他精通词条外，你还可以激活推离或失衡精通词条。'],
      },
      14: {
        name: '世界树之奇旅',
        nameEn: 'Travel along the Tree',
        description: '当你激活狂暴时，你可以传送至多60尺的距离，到一处你可见的未占据空间中。在你的狂暴激活期间，你也能够以一个附赠动作来进行传送。',
        details: [
          '此外，每次狂暴期间仅一次，你可以使传送的距离提升至150尺，并可以选择带上至多6个位于你10尺内的自愿生物同你一起传送。每个其他生物都将被传送至位于你目的地10尺内的你选择的未占据空间中。',
        ],
      },
    },
    zealot: {
      3: [
        {
          name: '神性之怒',
          nameEn: 'Divine Fury',
          description: '你可以引导神性的怒火，将其注入打击之中。',
          details: [
            '你的狂暴激活期间，你的每个回合中你首次以武器或徒手打击命中的生物将受到等于1d6+你野蛮人等级的一半（向下取整）的额外伤害。额外伤害的伤害类型为光耀或暗蚀，在每次造成伤害时由你选择伤害类型。',
          ],
        },
        {
          name: '神之勇者',
          nameEn: 'Warrior of the Gods',
          description: '某个神圣实体对你施以援手以确保你总能继续战斗。你获得一个有着4枚d12的治疗池，你可以用其中的骰子治愈自身。',
          details: [
            '以一个附赠动作，你可以消耗治疗池中任意枚骰子来恢复你的生命值。投掷所有你消耗的骰子，将它们相加，即是你以此恢复的生命值。当你完成一次长休时，你的治疗池重获所有已消耗的骰子。治疗池中骰子的最大数量将会在你到达特定野蛮人等级时增加，分别为6级时增加至5枚，12级时增加至6枚，17级时增加至7枚。',
          ],
        },
      ],
      6: {
        name: '专心炽志',
        nameEn: 'Fanatical Focus',
        description: '每次狂暴期间仅一次，若你失败于某次豁免检定，你可以重骰这次检定并在检定中获得等于你的狂暴伤害加值的加值，你必须使用重骰后的结果。',
        details: [],
      },
      10: {
        name: '狂热威仪',
        nameEn: 'Zealous Presence',
        description: '以一个附赠动作，你以满腔神圣能量发出战吼。选择至多十名位于你60尺内的生物，直至你的下个回合开始，他们的攻击检定和豁免检定具有优势。',
        details: ['此特性一经使用，直至完成长休你都无法再次使用。你也可以消耗一次狂暴使用次数（无需动作）来重置此特性的使用权。'],
      },
      14: {
        name: '神之狂暴',
        nameEn: 'Rage of the Gods',
        description: '当你激活狂暴时，你可以呈现出圣斗士姿态。圣斗士姿态持续1分钟，且在你生命值降至0时提前结束。此特性一经使用，直至完成长休你都无法再次使用。',
        details: [
          '处于圣斗士姿态期间，你获得以下增益：飞翔（你具有等于你速度的飞行速度，并且可以悬浮）；抗性（你具有对暗蚀、心灵和光耀伤害的抗性）；回春（当位于你30尺内的一名生物的生命值将要降至0时，你能够以反应消耗一次狂暴使用次数，令目标的生命值变为等于你野蛮人等级的值）。',
        ],
      },
    },
  },
  bard: {
    lore: {
      3: [
        {
          name: '附赠熟练',
          nameEn: 'Bonus Proficiencies',
          description: '你获得三项由你选择的技能的熟练。',
          details: [],
        },
        {
          name: '语出惊人',
          nameEn: 'Cutting Words',
          description: '你学会了如何运用你的妙语连珠来超自然地打断敌人、分散注意亦或是削弱他人的自信心和行动力。',
          details: [
            '当一名你可见的位于你60尺内的生物进行伤害掷骰、成功于一次属性检定或攻击检定时，你能够以反应消耗一次诗人激励使用次数，并掷诗人激励骰，然后从该生物的掷骰结果中减去诗人骰的骰值，这将降低其造成的伤害或可能使这次检定的成功变为失败。',
          ],
        },
      ],
      6: {
        name: '魔法探秘',
        nameEn: 'Magical Discoveries',
        description: '你习得两道自选法术。这些法术可以从牧师、德鲁伊或法师的法术列表中单独或组合选择。你选择的法术必须是戏法或是你拥有对应环阶法术位的法术。你始终准备着你选择的这些法术。',
        details: ['每当你获得一个吟游诗人等级时，你可以将其中一个法术替换为另一个满足上述要求的法术。'],
      },
      14: {
        name: '超凡技艺',
        nameEn: 'Peerless Skill',
        description: '当你进行一次属性检定或攻击检定并在检定中失败时，你可以消耗一次诗人激励使用次数，投掷诗人激励骰，并将掷骰结果加到d20中，这可能使这次检定的失败变为成功。',
        details: ['若检定仍然失败，将不会被消耗诗人激励次数。'],
      },
    },
  },
};

/**
 * 获取子职业在指定等级获得的特性详情列表（用于升级页、特性页展示「子职特性」）
 * 多数等级为单条，兽心/狂热者 3 级等为多条；无数据时返回空数组
 */
export function getSubclassFeaturesByLevel(
  classId: string,
  subclassId: string,
  level: number
): SubclassFeatureDetail[] {
  const byClass = SUBCLASS_FEATURES[classId];
  if (!byClass) return [];
  const bySubclass = byClass[subclassId];
  if (!bySubclass) return [];
  const raw = bySubclass[level];
  if (!raw) return [];
  return Array.isArray(raw) ? raw : [raw];
}
