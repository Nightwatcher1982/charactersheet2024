# 加入战役场景 Sub-Agent 验证报告

**场景**：已创建战役 + 测试用户选择已创建角色并加入战役。

**执行时间**：按对话中「用 sub agent 检查创建的战役可以用测试用户进行选择自己已经创建好的角色并加入战役」需求执行。

## 验证方式

- **脚本**：`node scripts/verify-join-campaign-flow.mjs`（项目根目录执行）。
- **前置**：角色卡服务（默认 3000）、DM 战役服务（默认 3001）已启动；已执行 `npx tsx scripts/create-test-users.ts`；玩家账号（player@test.com）在角色卡中至少有一个角色。

## 验证结果（2025-02-09）

| 步骤 | 验证项 | 结果 |
|------|--------|------|
| 1 | 会员登录角色卡并取得 JWT | ✔ 通过 |
| 2 | 玩家登录角色卡并取得 JWT | ✔ 通过 |
| 3 | 会员在 DM 创建战役，获得邀请码 | ✔ 通过 |
| 4 | 玩家在角色卡中已有角色，取第一个用于加入 | ✔ 通过 |
| 5 | DM GET /api/characters 能正确返回玩家已创建的角色（可支撑加入页选择角色） | ✔ 通过 |
| 6 | 玩家用邀请码 + 角色 ID 调用 DM 加入战役 | ✔ 通过 |
| 7 | 玩家战役列表包含已加入的战役 | ✔ 通过 |

**汇总**：通过 7 项，失败 0 项。

## 覆盖的链路

- 会员在 DM 创建战役 → 获得邀请码。
- 玩家在角色卡中已有角色。
- **DM 代理角色列表**：玩家通过 DM 的 `GET /api/characters`（Bearer 玩家 JWT）拿到与角色卡一致的「我的角色」列表，即加入页「选择已创建角色」所依赖的接口。
- 玩家调用 `POST /api/campaigns/join`（inviteCode + characterId）完成加入。
- 玩家战役列表包含该战役。

## 结论

「创建的战役 + 测试用户选择已创建角色并加入战役」的完整场景在自动化脚本下验证通过，DM 代理角色列表与加入战役 API 行为符合预期。
