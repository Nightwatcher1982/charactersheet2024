# 待开发与可完善项

对照《用户系统设计方案》与《用户系统开发计划方案》，当前**尚未实现或可进一步完善**的内容如下。

---

## 一、明确未实现

### 1. 用户协议与隐私政策页面

- **现状**：登录/注册页中「用户协议」「隐私政策」链接为 `href="#"`，无实际页面。
- **建议**：新增 `/terms`（用户协议）、`/privacy`（隐私政策）静态页或 Markdown 渲染页，注册页链接改为上述路径。
- **优先级**：中（上线前建议补齐，避免合规风险）。

---

### 2. 立绘上传走 OSS（前端接入）

- **现状**：`POST /api/upload/portrait` 已实现并上传至 OSS；立绘画册页 `app/characters/[id]/portraits/page.tsx` 仍使用 **FileReader + base64** 写入角色数据，未调用上传接口。
- **影响**：立绘仍以 base64 存于角色 JSON，数据体积大，与「立绘存 OSS、角色只存 URL」的设计不一致。
- **建议**：在立绘上传流程中改为：先 `POST /api/upload/portrait` 拿到 URL，再将 URL 写入 `character.avatar` / `character.portraits`；展示时对 URL 用 `getAssetPath`（若为相对路径）或直接使用完整 URL。兼容已有 base64 数据（前端判断是 data URL 还是 http(s) URL）。
- **优先级**：高（与 OSS 资源约定一致）。

---

### 3. 会员专属功能（具体业务）

- **现状**：`lib/auth.ts` 中已有 `requireMember`、`isMemberRole`，但**没有任何接口或页面**使用（无「仅会员可用」的接口或前端逻辑）。
- **设计**：开发计划 2.10 写明「预留校验 helper；**具体会员功能后续迭代**」。
- **建议**：由产品定义会员权益（例如：仅会员可创建超过 N 张角色卡、仅会员可导出 PDF、仅会员可使用某模板等），再在对应 API 与前端调用 `requireMember()` 或 `isMemberRole(role)`。
- **优先级**：按产品排期（无具体权益时可暂不开发）。

---

## 二、可选增强

### 4. 后台用户列表「昵称」筛选

- **现状**：`GET /api/admin/users` 已支持 `displayName` 查询参数；后台用户列表页仅有「邮箱」「等级」筛选，**无昵称筛选**。
- **建议**：在用户管理筛选区增加「昵称」输入框，请求时带上 `displayName` 参数。
- **优先级**：低。

---

### 5. 后台查看单张角色卡详情（只读）

- **现状**：后台可查看某用户的**角色卡列表**（名称、职业、等级、时间）；无法在后台查看**某一张角色卡的完整 data（只读）**。
- **设计**：开发计划 4.9 提到「查看用户角色卡列表**与详情**（只读）」。
- **建议**：新增 `GET /api/admin/users/[userId]/characters/[characterId]` 返回单张角色卡完整 data；后台用户详情页在角色卡列表中为每行增加「查看」链接，打开只读详情（或弹窗展示 JSON/关键字段）。
- **优先级**：低。

---

### 6. 审计日志按时间范围筛选

- **现状**：审计日志支持按操作类型、目标用户 ID 筛选与分页，**无按时间范围（起止时间）筛选**。
- **建议**：`GET /api/admin/audit-logs` 增加 `from`、`to` 查询参数（ISO 日期或时间戳），用于排查某时间段内的操作。
- **优先级**：低。

---

### 7. 老用户迁移（若有历史数据）

- **设计**：设计方案「迁移与兼容」中提及：原仅 `phone` 的老用户需补全 `email`、`passwordHash`，或生成 `legacy-{id}@internal` 等。
- **建议**：若线上存在仅手机号、无邮箱的老用户，需单独写迁移脚本或「绑定邮箱并设密」流程；若为新项目无历史用户，可忽略。
- **优先级**：视是否有老数据而定。

---

## 三、已实现且无需再开发（供对照）

- P1：注册/登录/登出、验证码、session 15 天/记住我 30 天、限流、协议勾选（仅勾选与存库，无协议正文页）。
- P2：个人资料、修改密码/忘记密码/更换邮箱、安全设置页、角色卡权限、立绘上传 **API**、会员等级字段与展示。
- P3：登录历史、多端登出、账号注销。
- P4：管理员登录、用户列表/详情、重置密码、改等级、查看用户角色卡列表、操作审计、审计日志查看页、忘记密码 Tab、后台概览统计（用户数/角色卡数）。

---

## 四、建议实施顺序

1. **立绘前端改走 OSS**：与现有 OSS 约定一致，减少角色 JSON 体积。
2. **用户协议与隐私政策页**：上线前补齐，链接到真实页面。
3. **会员专属功能**：等产品定义具体权益后再做。
4. **后台昵称筛选、单张角色卡详情、审计时间范围**：按需排期，均为增强项。

如需对某一项做详细实现方案或直接改代码，可以指定序号或功能名称。
