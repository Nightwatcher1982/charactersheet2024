# 法术数据来源说明

项目内 **一环至九环法术** 的权威数据来自 `docs/DND资料/` 下的一组 Markdown 文件，由脚本解析后生成 `lib/spells-from-docs.generated.ts`，供 `lib/spells-data.ts` 引用。**戏法**仍使用 `lib/spells-data.ts` 内手写的 `CANTRIPS`。

## 一、文档列表与环阶

| 文件 | 环阶 | 说明 |
|------|------|------|
| `docs/DND资料/一环法术.md` | 1 | 一环 |
| `docs/DND资料/二环法术.md` | 2 | 二环 |
| … | … | … |
| `docs/DND资料/九环法术.md` | 9 | 九环 |

## 二、单个法术的文档结构

每个法术占一段连续内容，**第一行**为标题，格式固定为：

```
中文名｜English Name
```

- 使用**全角竖线** `｜`（U+FF5C）分隔中文名与英文名。
- 英文名用于生成 `id`（小写、空格与 `/` 转为 `-`，如 `Power Word Heal` → `power-word-heal`）。

**第二行**为环阶、学派与职业列表：

- **戏法**：`学派 戏法（职业1、职业2、…）`  
  例：`塑能 戏法（术士、法师、奇械师）`
- **一环～九环**：`环阶 学派（职业1、职业2、…）`  
  例：`一环 防护（游侠、法师、奇械师）`、`三环 死灵（牧师、法师）`

其中括号为**全角** `（）`（U+FF08、U+FF09），职业之间用**顿号** `、`（U+3001）分隔。

**第三行起**为四个固定字段（顺序可任意，每行一个）：

- `施法时间：...`（若含「或仪式」则解析为 `ritual: true`）
- `施法距离：...`
- `法术成分：...`
- `持续时间：...`

冒号可为全角 `：` 或半角 `:`。

**之后**为法术描述（可多段）。若出现以 `戏法强化。` 或 `升环施法。` 开头的段落，则从该段起截出并写入 `higherLevel`，前面部分为 `description`。

## 三、学派与职业

- **学派**：防护、咒法、预言、惑控、塑能、幻术、死灵、变化。  
  文档中的「惑控」在生成数据时会映射为代码中的「附魔」，以与现有 `Spell.school` 一致。
- **职业**：与 `lib/dnd-data.ts`、`lib/spells-data.ts` 中的职业名称一致，如：吟游诗人、牧师、德鲁伊、圣武士、游侠、术士、魔契师、法师、奇械师等。

## 四、如何更新数据

1. 直接编辑 `docs/DND资料/一环法术.md` … `docs/DND资料/九环法术.md`。
2. 在项目根目录执行：
   ```bash
   node scripts/parse-spells-from-docs.mjs
   ```
3. 会覆盖生成 `lib/spells-from-docs.generated.ts`。该文件为自动生成，请勿手改。
4. `lib/spells-data.ts` 已接入 `SPELLS_1_FROM_DOCS` … `SPELLS_9_FROM_DOCS`，构建/运行时会自动使用最新法术数据。

## 五、生成产物

- **脚本**：`scripts/parse-spells-from-docs.mjs`
- **输出**：`lib/spells-from-docs.generated.ts`
  - 导出：`CANTRIPS_FROM_DOCS`、`SPELLS_1_FROM_DOCS` … `SPELLS_9_FROM_DOCS`、`ALL_SPELLS_FROM_DOCS`
  - 每条记录符合 `Spell` 类型（`id`、`name`、`nameEn`、`level`、`school`、`castingTime`、`range`、`components`、`duration`、`description`、`higherLevel?`、`ritual?`、`classes`、`source?`）
